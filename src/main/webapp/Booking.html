<div id="chart"></div>

<script src="https://cdn.seats.io/chart.js"></script>
<script src="BookingLogic.html"></script>
<script>
    new seatsio.SeatingChart({
        divId: 'chart',
        publicKey: '89ab0607-2506-4201-aac9-947f3327fc42',
        event: '0d9ae045-65e2-4671-b2ee-32170c64c80e',

        pricing: [
            {'category': 3, 'ticketTypes': [
                    {'ticketType': 'Student', 'price': 6},
                    {'ticketType': 'Normal', 'price': 8},
                    {'ticketType': 'OAP', 'price': 7}

                ]},
            {'category': 7, 'ticketTypes': [
                    {'ticketType': 'Student', 'price': 11},
                    {'ticketType': 'Normal', 'price': 13},
                    {'ticketType': 'OAP', 'price': 12}
                ]},
            {'category': 8, 'ticketTypes': [
                    {'ticketType': 'Student', 'price': 6},
                    {'ticketType': 'Normal', 'price': 8},
                    {'ticketType': 'OAP', 'price': 7}
                ]}
        ],

        priceFormatter: function(price) {
            return 'Â£' + price;
        },

        tooltipText: function(object) {
            if (object.status !== 'free') {
                return 'Seat has been reserved, sorry!';

            }
            if(object.category.label == 'Wheelchair' && object.status == 'free'){

                return 'Wheelchair seat is free to select'
            }
            if(object.category.label == 'Premium' && object.status == 'free'){

                return 'Premium seat is free to select'
            }
            if(object.category.label == 'Standard' && object.status == 'free'){

                return 'Standard seat is free to select'
            }

        },

        
        /*showRowLines:true, 
        *showRowLabels:true,
        *These parameters look clunky when rendered but may be necessary 
        */
        
        holdOnSelect:true, //3 minutes, changeable in settings
        showLegend:true,
        legend:{hidePricing:true},
        //regenerateHoldToken:true,

        onObjectSelected(object){
            
            var ticket = object.selectedTicketType
            var index
            
            console.log(object.category.label)
            console.log(object.label)
            console.log(object.selectedTicketType)
          

            if (ticket == "Student"){
                index = 0
            }

            if(ticket == "Normal"){
                index = 1
            }

            if(ticket == "OAP"){
                index = 2
            }

            console.log(object.pricing.ticketTypes[index].price)
            
            
           
            var ticket=new Ticket(object.category.label,object.selectedTicketType,object.label, object.pricing.ticketTypes[index].price)
            object.holdOnSelect
            createTicket(ticket);
           
        },
        
        onObjectDeselected(object){
            var ticket = object.selectedTicketType
            var index          

            if (ticket == "Student"){
                index = 0
            }

            if(ticket == "Normal"){
                index = 1
            }

            if(ticket == "OAP"){
                index = 2
            }

            console.log(object.pricing.ticketTypes[index].price)
            
            
           var ticket=new Ticket(object.category.label,object.selectedTicketType,object.label, object.pricing.ticketTypes[index].price)
           removeTicket(ticket);
            
        },      
        
        /*selectionValidators: [
        *   {type: 'noOrphanSeats'},
        *    {type: 'consecutiveSeats'},
        ]*/
        
    }).render();
    
    class Ticket{
        constructor(seatId,seatCat,customerCat,price){
            this.seatId=seatId;
            this.seatCat=seatCat;
            this.customerCat=customerCat;
            this.price=price;
            
            
        }
    }
    
    var selectedTickets=[];
    
    function createTicket(x){
        var ticket = JSON.stringify(x)
        selectedTickets.push(ticket);
        window.alert("your ticket is: "+ticket)
        window.alert("All tickets are:  "+selectedTickets)
        
    }
    function removeTicket(x){
        var ticket = JSON.stringify(x)
        
        for(var i =0;i<selectedTickets.length ; i++) {
            if(selectedTickets[i] === ticket) {
                selectedTickets.splice(i,1);
                
            }
        }
    }

</script>
<input type=button value="Buy Now" onclick="createTicket()">